import{r as c,D as B,y as T,c as $,o as w,a as e,t as _,b as f,v as y,E as F,z as L,d as x,f as O,g as k,F as j,k as E,h as D,s as p,n as I}from"./index-Drcz_wGL.js";import{a as z,_ as q}from"./Pagination-yifaCfQs.js";const P={class:"modal-dialog",role:"document"},A={class:"modal-content"},G={class:"modal-header"},H={class:"modal-title"},J={class:"modal-body"},K={class:"mb-3"},Q={class:"mb-3"},R={class:"mb-3"},W={class:"mb-3"},X={class:"form-check mb-3"},Y={class:"modal-footer"},Z={__name:"CouponModal",props:{coupon:{type:Object,default:()=>({})},isNew:{type:Boolean,default:!0}},emits:["update-coupon"],setup(C,{expose:h}){const v=C,i=c(null),s=c(g()),r=c(""),{showModal:m,hideModal:b}=B(i);T(()=>v.coupon,a=>{const t=g(),l=a&&Object.keys(a).length?a:t;if(s.value={...t,...l},s.value.due_date){const M=new Date(s.value.due_date*1e3);r.value=M.toISOString().split("T")[0]}else r.value=""},{immediate:!0}),T(r,a=>{if(!a)return;const t=new Date(a).getTime();Number.isFinite(t)&&(s.value.due_date=Math.floor(t/1e3))});function g(){return{title:"",code:"",percent:100,is_enabled:0,due_date:Math.floor(Date.now()/1e3)}}return h({showModal:m,hideModal:b}),(a,t)=>(w(),$("div",{class:"modal fade",tabindex:"-1","aria-hidden":"true",ref_key:"modal",ref:i},[e("div",P,[e("div",A,[e("div",G,[e("h5",H,[e("span",null,_(C.isNew?"新增優惠券":"編輯優惠券"),1)]),t[6]||(t[6]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",J,[e("div",K,[t[7]||(t[7]=e("label",{for:"title",class:"form-label"},"標題",-1)),f(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[0]||(t[0]=l=>s.value.title=l),placeholder:"請輸入標題"},null,512),[[y,s.value.title]])]),e("div",Q,[t[8]||(t[8]=e("label",{for:"coupon_code",class:"form-label"},"優惠碼",-1)),f(e("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":t[1]||(t[1]=l=>s.value.code=l),placeholder:"請輸入優惠碼"},null,512),[[y,s.value.code]])]),e("div",R,[t[9]||(t[9]=e("label",{for:"due_date",class:"form-label"},"到期日",-1)),f(e("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":t[2]||(t[2]=l=>r.value=l)},null,512),[[y,r.value]])]),e("div",W,[t[10]||(t[10]=e("label",{for:"percent",class:"form-label"},"折扣百分比",-1)),f(e("input",{type:"number",class:"form-control",id:"percent","onUpdate:modelValue":t[3]||(t[3]=l=>s.value.percent=l),min:"1",max:"100",placeholder:"請輸入折扣百分比"},null,512),[[y,s.value.percent,void 0,{number:!0}]])]),e("div",X,[f(e("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[4]||(t[4]=l=>s.value.is_enabled=l),id:"is_enabled"},null,512),[[F,s.value.is_enabled]]),t[11]||(t[11]=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1))])]),e("div",Y,[t[12]||(t[12]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:t[5]||(t[5]=l=>a.$emit("update-coupon",s.value))}," 儲存變更 ")])])])],512))}},ee={class:"d-flex justify-content-between align-items-center my-4"},te={class:"table-responsive"},oe={class:"table table-hover align-middle text-nowrap"},se={class:"text-center"},le={class:"text-center"},ae={class:"text-center"},ne={class:"text-center"},ue={class:"btn-group"},ie=["onClick"],de=["onClick"],pe={__name:"Coupons",setup(C){const h=c([]),v=c({}),i=c(N()),s=c(!1),r=c(!1),m=c(null),b=c(null),g=n=>{const o=new Date(Number(n)*1e3);return Number.isFinite(o.getTime())?o.toISOString().split("T")[0]:"未設定"},a=async(n=1)=>{const o=`https://vue3-course-api.hexschool.io/v2/api/xenosword-api/admin/coupons?page=${n}`;s.value=!0;try{const d=await D.get(o);d.data.success?(h.value=d.data.coupons,v.value=d.data.pagination):p("error",d.data.message||"優惠券載入失敗")}catch(d){console.error("載入優惠券失敗",d),p("error","優惠券載入失敗")}finally{s.value=!1}},t=(n,o)=>{r.value=n,n?i.value=N():i.value={...o},m.value.showModal()},l=n=>{i.value={...n},b.value.showModal()},M=async n=>{i.value=n;let o="https://vue3-course-api.hexschool.io/v2/api/xenosword-api/admin/coupon",d="post";r.value||(o=`https://vue3-course-api.hexschool.io/v2/api/xenosword-api/admin/coupon/${i.value.id}`,d="put"),s.value=!0;try{const u=await D[d](o,{data:i.value});u.data.success?(m.value.hideModal(),p("success",r.value?"新增優惠券成功":"更新優惠券成功"),await a(v.value?.current_page||1)):p("error",u.data.message||"保存優惠券失敗")}catch(u){console.error("儲存優惠券失敗",u),p("error","儲存優惠券失敗")}finally{s.value=!1}},U=async()=>{const n=`https://vue3-course-api.hexschool.io/v2/api/xenosword-api/admin/coupon/${i.value.id}`;s.value=!0;try{await D.delete(n),b.value.hideModal(),p("success","優惠券已刪除"),await a(v.value?.current_page||1)}catch(o){console.error("刪除優惠券失敗",o),p("error","刪除優惠券失敗")}finally{s.value=!1}};function N(){return{title:"",code:"",percent:100,is_enabled:0,due_date:Math.floor(Date.now()/1e3)}}return L(a),(n,o)=>{const d=O("Loading");return w(),$("div",null,[x(d,{active:s.value},null,8,["active"]),e("div",ee,[o[2]||(o[2]=e("h2",{class:"h4 fw-bold"},"優惠券管理",-1)),e("button",{class:"btn btn-primary d-flex align-items-center gap-1",onClick:o[0]||(o[0]=u=>t(!0))},[...o[1]||(o[1]=[e("i",{class:"bi bi-plus-circle"},null,-1),k(" 新增優惠券 ",-1)])])]),e("div",te,[e("table",oe,[o[5]||(o[5]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"名稱"),e("th",{class:"text-center"},"折扣百分比"),e("th",{class:"text-center"},"到期日"),e("th",{class:"text-center"},"狀態"),e("th",{class:"text-center"},"操作")])],-1)),e("tbody",null,[(w(!0),$(j,null,E(h.value,(u,S)=>(w(),$("tr",{key:S},[e("td",null,_(u.title),1),e("td",se,_(u.percent)+"%",1),e("td",le,_(g(u.due_date)),1),e("td",ae,[e("span",{class:I(["badge",u.is_enabled===1?"bg-success":"bg-secondary"])},_(u.is_enabled===1?"啟用中":"未啟用"),3)]),e("td",ne,[e("div",ue,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:V=>t(!1,u)},[...o[3]||(o[3]=[e("i",{class:"bi bi-pencil-square"},null,-1),k(" 編輯 ",-1)])],8,ie),e("button",{class:"btn btn-outline-danger btn-sm",onClick:V=>l(u)},[...o[4]||(o[4]=[e("i",{class:"bi bi-trash"},null,-1),k(" 刪除 ",-1)])],8,de)])])]))),128))])])]),x(Z,{ref_key:"couponModal",ref:m,coupon:i.value,isNew:r.value,onUpdateCoupon:M},null,8,["coupon","isNew"]),x(z,{ref_key:"delModal",ref:b,item:i.value,onDelItem:U},null,8,["item"]),x(q,{pages:v.value,onEmitPages:a},null,8,["pages"])])}}};export{pe as default};
