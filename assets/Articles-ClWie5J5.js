import{r as u,D as B,y as j,c,o as p,a as t,t as v,j as D,b,v as g,F as P,k as N,E as T,z as E,d as M,f as S,g as C,h as A,s as h,n as z}from"./index-Drcz_wGL.js";import{_ as F,a as I}from"./Pagination-yifaCfQs.js";const q={class:"modal-dialog modal-lg",role:"document"},O={class:"modal-content border-0"},V={class:"modal-header bg-dark text-white"},G={class:"modal-title"},H={class:"modal-body"},J={class:"mb-3"},K={class:"mb-3"},Q={class:"mb-3"},R=["src"],W={class:"mb-3"},X={class:"mt-1"},Y={class:"mb-3"},Z={class:"mb-3"},tt={class:"mb-3"},et={class:"form-check"},lt={key:0,class:"mb-3 text-muted small"},st={class:"modal-footer"},at={__name:"ArticleModal",props:{article:{type:Object,default:()=>({})},isNew:{type:Boolean,default:!0}},emits:["update-article"],setup($,{expose:w}){const _=$,r=u(null),{showModal:y,hideModal:x}=B(r),l=u({}),m=u("");j(()=>_.article,a=>{l.value={title:a?.title||"",author:a?.author||"",image:a?.image||"",tag:Array.isArray(a?.tag)?a.tag:[],description:a?.description||"",content:a?.content||"",isPublic:typeof a?.isPublic=="boolean"?a.isPublic:!1,create_at:a?.create_at||Date.now(),id:a?.id||void 0},m.value=l.value.tag.join(",")},{immediate:!0});const f=()=>{l.value.tag=m.value.split(",").map(a=>a.trim()).filter(a=>a)};return w({showModal:y,hideModal:x}),(a,e)=>(p(),c("div",{class:"modal fade",tabindex:"-1",ref_key:"modal",ref:r},[t("div",q,[t("div",O,[t("div",V,[t("h5",G,[t("span",null,v($.isNew?"新增消息":"編輯消息"),1)]),e[8]||(e[8]=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"},null,-1))]),t("div",H,[t("div",J,[e[9]||(e[9]=t("label",{for:"title",class:"form-label"},"標題",-1)),b(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>l.value.title=o),type:"text",class:"form-control",id:"title",placeholder:"請輸入標題"},null,512),[[g,l.value.title]])]),t("div",K,[e[10]||(e[10]=t("label",{for:"author",class:"form-label"},"作者",-1)),b(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>l.value.author=o),type:"text",class:"form-control",id:"author",placeholder:"請輸入作者"},null,512),[[g,l.value.author]])]),t("div",Q,[e[11]||(e[11]=t("label",{for:"image",class:"form-label"},"封面圖片網址",-1)),b(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>l.value.image=o),type:"text",class:"form-control",id:"image",placeholder:"請輸入圖片連結"},null,512),[[g,l.value.image]]),l.value.image?(p(),c("img",{key:0,class:"img-fluid mt-2",src:l.value.image,alt:"預覽圖片"},null,8,R)):D("",!0)]),t("div",W,[e[12]||(e[12]=t("label",{for:"tag",class:"form-label"},"標籤（逗號分隔）",-1)),b(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>m.value=o),onBlur:f,type:"text",class:"form-control",id:"tag",placeholder:"例如：公告,活動,優惠"},null,544),[[g,m.value]]),t("div",X,[(p(!0),c(P,null,N(l.value.tag,o=>(p(),c("span",{key:o,class:"badge bg-info me-1"},v(o),1))),128))])]),t("div",Y,[e[13]||(e[13]=t("label",{for:"description",class:"form-label"},"摘要",-1)),b(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=o=>l.value.description=o),class:"form-control",id:"description",rows:"2",placeholder:"請輸入文章摘要"},null,512),[[g,l.value.description]])]),t("div",Z,[e[14]||(e[14]=t("label",{for:"content",class:"form-label"},"內容",-1)),b(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=o=>l.value.content=o),class:"form-control",id:"content",rows:"6",placeholder:"請輸入詳細內容"},null,512),[[g,l.value.content]])]),t("div",tt,[t("div",et,[b(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>l.value.isPublic=o),class:"form-check-input",type:"checkbox",id:"isPublic"},null,512),[[T,l.value.isPublic]]),e[15]||(e[15]=t("label",{class:"form-check-label",for:"isPublic"},"是否公開",-1))])]),$.isNew?D("",!0):(p(),c("div",lt," 建立時間："+v(new Date(l.value.create_at).toLocaleString()),1))]),t("div",st,[e[16]||(e[16]=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1)),t("button",{type:"button",class:"btn btn-primary",onClick:e[7]||(e[7]=o=>a.$emit("update-article",l.value))}," 儲存 ")])])])],512))}},ot={class:"d-flex justify-content-between align-items-center my-4"},it={class:"table-responsive"},nt={class:"table table-hover align-middle text-nowrap"},rt={class:"text-center"},dt={class:"text-center"},ut={class:"btn-group"},ct=["onClick"],pt=["onClick"],bt={__name:"Articles",setup($){const w=u([]),_=u({}),r=u({}),y=u(!1),x=u(!1),l=u(null),m=u(null),f=async(i=1)=>{const s=`https://vue3-course-api.hexschool.io/v2/api/xenosword-api/admin/articles?page=${i}`;x.value=!0;try{const d=await A.get(s);d.data.success&&(w.value=d.data.articles,_.value=d.data.pagination)}catch{h("error","資料載入失敗")}finally{x.value=!1}},a=async i=>{const s=`https://vue3-course-api.hexschool.io/v2/api/xenosword-api/admin/article/${i}`;try{const d=await A.get(s);d.data.success&&(r.value=d.data.article)}catch{h("error","資料載入失敗")}},e=async(i,s)=>{y.value=i,i?r.value={title:"",author:"",image:"",tag:[],description:"",content:"",isPublic:!1,create_at:Date.now()}:await a(s.id),l.value.showModal()},o=async i=>{r.value=i;let s="https://vue3-course-api.hexschool.io/v2/api/xenosword-api/admin/article",d="post";y.value||(s=`https://vue3-course-api.hexschool.io/v2/api/xenosword-api/admin/article/${i.id}`,d="put");try{const n=await A[d](s,{data:r.value});l.value.hideModal(),n.data.success?(await f(),h("success","更新成功")):h("error","更新失敗，請確認是否有欄位未填寫")}catch{h("error","更新失敗，請確認是否有欄位未填寫")}},U=i=>{r.value={...i},m.value.showModal()},L=async()=>{const i=`https://vue3-course-api.hexschool.io/v2/api/xenosword-api/admin/article/${r.value.id}`;try{await A.delete(i),m.value.hideModal(),await f()}catch{h("error","資料刪除失敗")}};return E(f),(i,s)=>{const d=S("Loading");return p(),c(P,null,[M(d,{active:x.value},null,8,["active"]),t("div",ot,[s[2]||(s[2]=t("h2",{class:"h4 fw-bold"},"消息更新",-1)),t("button",{class:"btn btn-primary d-flex align-items-center gap-1",onClick:s[0]||(s[0]=n=>e(!0))},[...s[1]||(s[1]=[t("i",{class:"bi bi-plus-circle"},null,-1),C(" 新增消息 ",-1)])])]),t("div",it,[t("table",nt,[s[5]||(s[5]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"標題"),t("th",{width:"120"},"作者"),t("th",{width:"160"},"標籤"),t("th",{width:"160"},"建立時間"),t("th",{width:"100",class:"text-center"},"狀態"),t("th",{width:"200",class:"text-center"},"操作")])],-1)),t("tbody",null,[(p(!0),c(P,null,N(w.value,n=>(p(),c("tr",{key:n.id},[t("td",null,v(n.title),1),t("td",null,v(n.author),1),t("td",null,[(p(!0),c(P,null,N(n.tag,k=>(p(),c("span",{key:k,class:"badge bg-info me-1"},v(k),1))),128))]),t("td",null,v(new Date(n.create_at).toLocaleString()),1),t("td",rt,[t("span",{class:z(["badge",n.isPublic?"bg-success":"bg-secondary"])},v(n.isPublic?"已發布":"以下架"),3)]),t("td",dt,[t("div",ut,[t("button",{class:"btn btn-outline-primary btn-sm",onClick:k=>e(!1,n)},[...s[3]||(s[3]=[t("i",{class:"bi bi-pencil-square"},null,-1),C(" 編輯 ",-1)])],8,ct),t("button",{class:"btn btn-outline-danger btn-sm",onClick:k=>U(n)},[...s[4]||(s[4]=[t("i",{class:"bi bi-trash"},null,-1),C(" 刪除 ",-1)])],8,pt)])])]))),128))])])]),M(F,{pages:_.value,onEmitPages:f},null,8,["pages"]),M(at,{ref_key:"articleModal",ref:l,article:r.value,isNew:y.value,onUpdateArticle:o},null,8,["article","isNew"]),M(I,{ref_key:"delModal",ref:m,item:r.value,onDelItem:L},null,8,["item"])],64)}}};export{bt as default};
