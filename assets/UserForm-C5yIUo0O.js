import{_ as U,p as F,q as $,r as E,x as k,z as I,c as r,o as n,d as t,a as e,j as _,f as V,g as u,F as h,k as N,t as m,e as g,G as d,H as j,u as B,I as b,n as f,J as v,b as M,v as T,h as z,s as q}from"./index-Drcz_wGL.js";const D={class:"my-5 row justify-content-center"},G={key:0,class:"col-lg-8 col-md-10 col-sm-12 mb-4"},H={class:"table table-hover align-middle border rounded shadow-sm"},J={class:"fw-semibold"},O={key:0,class:"badge bg-success mt-1"},R={class:"text-center"},A={class:"text-end text-nowrap"},K={class:"border-top"},P={class:"text-end text-primary fw-semibold"},Q={key:0},W={class:"text-end text-success fw-semibold"},X={class:"text-end"},Y={key:1,class:"col-md-6 mb-4 text-center display-5 title"},Z={class:"text-end mt-3"},ss={key:0,class:"my-5 row justify-content-center"},es={class:"col-lg-8 col-md-10 col-sm-12"},ts={class:"card shadow-sm"},ls={class:"card-body"},as={class:"mb-3"},os={class:"mb-3"},ds={class:"mb-3"},rs={class:"mb-3"},ns={class:"mb-3"},is={__name:"UserForm",setup(us){const p=F(),y=$(),C=B(),l=E({user:{name:"",email:"",tel:"",address:""},message:""}),i=k(()=>p.cart),L=k(()=>y.isLoading),S=async()=>{const c="https://vue3-course-api.hexschool.io/v2/api/xenosword-api/order";y.isLoading=!0;try{const s=await z.post(c,{data:l.value});if(s.data.success){q("success","已送出訂單");const x=s.data.orderId;await p.getCart(),C.push(`/user/checkout/${x}`)}}catch{q("error","資料新增失敗")}finally{y.isLoading=!1}};return I(()=>{p.getCart()}),(c,s)=>{const x=V("Loading"),w=V("router-link");return n(),r(h,null,[t(x,{active:L.value},null,8,["active"]),e("div",D,[i.value.carts.length!==0?(n(),r("div",G,[s[9]||(s[9]=e("h5",{class:"fw-bold mb-3"},[e("i",{class:"bi bi-bag-check-fill me-2 text-primary"}),u(" 購買明細")],-1)),e("table",H,[s[7]||(s[7]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"品名"),e("th",{class:"text-center"},"數量"),e("th",{class:"text-end"},"單價")])],-1)),e("tbody",null,[(n(!0),r(h,null,N(i.value.carts,a=>(n(),r("tr",{key:a.id},[e("td",null,[e("div",J,m(a.product.title),1),a.coupon?(n(),r("span",O,"已套用優惠券")):_("",!0)]),e("td",R,m(a.qty),1),e("td",A,m(c.$filters.currency(a.final_total)),1)]))),128))]),e("tfoot",K,[e("tr",null,[s[5]||(s[5]=e("td",{colspan:"2",class:"text-end fw-bold"},"總計",-1)),e("td",P,m(c.$filters.currency(i.value.total)),1)]),i.value.final_total!==i.value.total?(n(),r("tr",Q,[s[6]||(s[6]=e("td",{colspan:"2",class:"text-end text-success fw-bold"},"折扣價",-1)),e("td",W,m(c.$filters.currency(i.value.final_total)),1)])):_("",!0)])]),e("div",X,[t(w,{to:"/cart",class:"btn btn-secondary"},{default:g(()=>[...s[8]||(s[8]=[u("返回商品頁",-1)])]),_:1})])])):(n(),r("div",Y,[s[11]||(s[11]=u(" 購物車為空，請返回商品頁選購 ",-1)),e("div",Z,[t(w,{to:"/cart",class:"btn btn-secondary"},{default:g(()=>[...s[10]||(s[10]=[u("返回商品頁",-1)])]),_:1})])]))]),i.value.carts.length!==0?(n(),r("div",ss,[e("div",es,[e("div",ts,[s[18]||(s[18]=e("div",{class:"card-header bg-primary text-white fw-bold fs-5 d-flex align-items-center"},[e("i",{class:"bi bi-pencil-square me-2"}),u(" 填寫寄送資料 ")],-1)),e("div",ls,[t(d(j),{onSubmit:S},{default:g(({errors:a})=>[e("div",as,[s[12]||(s[12]=e("label",{for:"email",class:"form-label fw-semibold"},"Email",-1)),t(d(b),{id:"email",name:"email",type:"email",class:f(["form-control",{"is-invalid":a.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:l.value.user.email,"onUpdate:modelValue":s[0]||(s[0]=o=>l.value.user.email=o)},null,8,["class","modelValue"]),t(d(v),{name:"email",class:"invalid-feedback"})]),e("div",os,[s[13]||(s[13]=e("label",{for:"name",class:"form-label fw-semibold"},"收件人姓名",-1)),t(d(b),{id:"name",name:"姓名",type:"text",class:f(["form-control",{"is-invalid":a.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:l.value.user.name,"onUpdate:modelValue":s[1]||(s[1]=o=>l.value.user.name=o)},null,8,["class","modelValue"]),t(d(v),{name:"姓名",class:"invalid-feedback"})]),e("div",ds,[s[14]||(s[14]=e("label",{for:"tel",class:"form-label fw-semibold"},"收件人電話",-1)),t(d(b),{id:"tel",name:"電話",type:"tel",class:f(["form-control",{"is-invalid":a.電話}]),placeholder:"請輸入電話",rules:"required",modelValue:l.value.user.tel,"onUpdate:modelValue":s[2]||(s[2]=o=>l.value.user.tel=o)},null,8,["class","modelValue"]),t(d(v),{name:"電話",class:"invalid-feedback"})]),e("div",rs,[s[15]||(s[15]=e("label",{for:"address",class:"form-label fw-semibold"},"收件人地址",-1)),t(d(b),{id:"address",name:"地址",type:"text",class:f(["form-control",{"is-invalid":a.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:l.value.user.address,"onUpdate:modelValue":s[3]||(s[3]=o=>l.value.user.address=o)},null,8,["class","modelValue"]),t(d(v),{name:"地址",class:"invalid-feedback"})]),e("div",ns,[s[16]||(s[16]=e("label",{for:"message",class:"form-label fw-semibold"},"留言 (選填)",-1)),M(e("textarea",{id:"message",class:"form-control",rows:"4",placeholder:"可輸入備註或希望的配送時間","onUpdate:modelValue":s[4]||(s[4]=o=>l.value.message=o)},null,512),[[T,l.value.message]])]),s[17]||(s[17]=e("div",{class:"text-end"},[e("button",{class:"btn btn-primary px-4 py-2"},[e("i",{class:"bi bi-send-fill me-1"}),u(" 送出訂單 ")])],-1))]),_:1})])])])])):_("",!0)],64)}}},ms=U(is,[["__scopeId","data-v-46fd751f"]]);export{ms as default};
