import{r as d,D as F,y as L,c as u,o as c,a as e,t as f,j as C,b as r,v as p,g as V,F as P,k as N,A,E as j,h as $,z as B,d as w,f as I,s as v,n as E}from"./index-Drcz_wGL.js";import{_ as T,a as z}from"./Pagination-yifaCfQs.js";const O={class:"modal-dialog modal-xl",role:"document"},S={class:"modal-content border-0"},q={class:"modal-header bg-dark text-white"},G={class:"modal-title",id:"productModalLabel"},H={class:"modal-body"},J={class:"row"},K={class:"col-sm-4"},Q={class:"mb-3"},R={class:"mb-3"},W={for:"customFile",class:"form-label"},X={key:0,class:"fas fa-spinner fa-spin"},Y=["src"],Z={key:0,class:"mt-5"},ee=["onUpdate:modelValue"],te=["onClick"],le={key:0},se={class:"col-sm-8"},oe={class:"mb-3"},ae={class:"row gx-2"},ne={class:"mb-3 col-md-6"},ie={class:"mb-3 col-md-6"},re={class:"row gx-2"},de={class:"mb-3 col-md-6"},ue={class:"mb-3 col-md-6"},ce={class:"mb-3"},pe={class:"mb-3"},me={class:"form-check mb-3"},ve={class:"modal-footer"},be={__name:"ProductModal",props:{product:{type:Object,default:()=>({})},isNew:{type:Boolean,default:!0}},emits:["update-product"],setup(k,{expose:_}){const b=k,i=d(null),s=d(U()),m=d(!1),{showModal:y,hideModal:h}=F(i);L(()=>b.product,n=>{const t=U(),l=n&&Object.keys(n).length?n:t;s.value={...t,...l,imagesUrl:Array.isArray(l.imagesUrl)?[...l.imagesUrl]:[],imageUrl:l.imageUrl||""}},{immediate:!0});const g=async n=>{const t=n.target.files?.[0];if(!t)return;const l=new FormData;l.append("file-to-upload",t);const a="https://vue3-course-api.hexschool.io/v2/api/xenosword-api/admin/upload";try{m.value=!0;const o=await $.post(a,l);o.data.success?s.value.imageUrl=o.data.imageUrl:alert(o.data.message||"圖片上傳失敗")}catch(o){console.error("圖片上傳錯誤",o),alert("圖片上傳失敗")}finally{m.value=!1,n.target.value=""}},x=()=>{Array.isArray(s.value.imagesUrl)||(s.value.imagesUrl=[]),s.value.imagesUrl.push("")},M=n=>{s.value.imagesUrl.splice(n,1)};function U(){return{title:"",category:"",unit:"",origin_price:0,price:0,description:"",content:"",is_enabled:0,imageUrl:"",imagesUrl:[]}}return _({showModal:y,hideModal:h}),(n,t)=>(c(),u("div",{class:"modal fade",id:"productModal",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true",ref_key:"modal",ref:i},[e("div",O,[e("div",S,[e("div",q,[e("h5",G,[e("span",null,f(k.isNew?"新增產品":"編輯產品"),1)]),t[10]||(t[10]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",H,[e("div",J,[e("div",K,[e("div",Q,[t[11]||(t[11]=e("label",{for:"image",class:"form-label"},"主要圖片網址",-1)),r(e("input",{type:"text",class:"form-control",id:"image","onUpdate:modelValue":t[0]||(t[0]=l=>s.value.imageUrl=l),placeholder:"請輸入圖片連結"},null,512),[[p,s.value.imageUrl]])]),e("div",R,[e("label",W,[t[12]||(t[12]=V(" 或上傳圖片 ",-1)),m.value?(c(),u("i",X)):C("",!0)]),e("input",{type:"file",id:"customFile",class:"form-control",accept:"image/*",onChange:g},null,32)]),e("img",{class:"img-fluid",src:s.value.imageUrl,alt:"主要產品圖片"},null,8,Y),s.value.imagesUrl?(c(),u("div",Z,[(c(!0),u(P,null,N(s.value.imagesUrl,(l,a)=>(c(),u("div",{key:`image-${a}`,class:"mb-3 input-group"},[r(e("input",{type:"url",class:"form-control","onUpdate:modelValue":o=>s.value.imagesUrl[a]=o,placeholder:"請輸入圖片連結"},null,8,ee),[[p,s.value.imagesUrl[a]]]),e("button",{type:"button",class:"btn btn-outline-danger",onClick:o=>M(a)}," 移除 ",8,te)]))),128)),s.value.imagesUrl[s.value.imagesUrl.length-1]!==""||!s.value.imagesUrl.length?(c(),u("div",le,[e("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:x}," 新增圖片 ")])):C("",!0)])):C("",!0)]),e("div",se,[e("div",oe,[t[13]||(t[13]=e("label",{for:"title",class:"form-label"},"標題",-1)),r(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[1]||(t[1]=l=>s.value.title=l),placeholder:"請輸入產品標題"},null,512),[[p,s.value.title]])]),e("div",ae,[e("div",ne,[t[15]||(t[15]=e("label",{for:"category",class:"form-label"},"分類",-1)),r(e("select",{class:"form-select",id:"category","onUpdate:modelValue":t[2]||(t[2]=l=>s.value.category=l)},[...t[14]||(t[14]=[e("option",{disabled:"",value:""},"請選擇分類",-1),e("option",{value:"主機"},"主機",-1),e("option",{value:"遊戲"},"遊戲",-1),e("option",{value:"周邊"},"周邊",-1)])],512),[[A,s.value.category]])]),e("div",ie,[t[16]||(t[16]=e("label",{for:"unit",class:"form-label"},"單位",-1)),r(e("input",{type:"text",class:"form-control",id:"unit","onUpdate:modelValue":t[3]||(t[3]=l=>s.value.unit=l),placeholder:"請輸入單位"},null,512),[[p,s.value.unit]])])]),e("div",re,[e("div",de,[t[17]||(t[17]=e("label",{for:"origin_price",class:"form-label"},"原價",-1)),r(e("input",{type:"number",class:"form-control",id:"origin_price","onUpdate:modelValue":t[4]||(t[4]=l=>s.value.origin_price=l),placeholder:"請輸入原價"},null,512),[[p,s.value.origin_price,void 0,{number:!0}]])]),e("div",ue,[t[18]||(t[18]=e("label",{for:"price",class:"form-label"},"售價",-1)),r(e("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":t[5]||(t[5]=l=>s.value.price=l),placeholder:"請輸入售價"},null,512),[[p,s.value.price,void 0,{number:!0}]])])]),t[22]||(t[22]=e("hr",null,null,-1)),e("div",ce,[t[19]||(t[19]=e("label",{for:"description",class:"form-label"},"產品描述",-1)),r(e("textarea",{class:"form-control",id:"description",rows:"2","onUpdate:modelValue":t[6]||(t[6]=l=>s.value.description=l),placeholder:"請輸入產品描述"},null,512),[[p,s.value.description]])]),e("div",pe,[t[20]||(t[20]=e("label",{for:"content",class:"form-label"},"說明內容",-1)),r(e("textarea",{class:"form-control",id:"content",rows:"4","onUpdate:modelValue":t[7]||(t[7]=l=>s.value.content=l),placeholder:"請輸入產品說明"},null,512),[[p,s.value.content]])]),e("div",me,[r(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=l=>s.value.is_enabled=l),"true-value":1,"false-value":0,id:"is_enabled"},null,512),[[j,s.value.is_enabled]]),t[21]||(t[21]=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1))])])])]),e("div",ve,[t[23]||(t[23]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:t[9]||(t[9]=l=>n.$emit("update-product",s.value))}," 儲存變更 ")])])])],512))}},ge={class:"d-flex justify-content-between align-items-center my-4"},fe={class:"table-responsive"},ye={class:"table table-hover align-middle text-nowrap"},he={class:"text-start"},_e={class:"text-start"},xe={class:"text-center"},Ue={class:"text-center"},we={class:"btn-group"},$e=["onClick"],ke=["onClick"],Ve={__name:"Products",setup(k){const _=d([]),b=d({}),i=d({}),s=d(!1),m=d(!1),y=d(null),h=d(null),g=async(t=1)=>{const l=`https://vue3-course-api.hexschool.io/v2/api/xenosword-api/admin/products?page=${t}`;m.value=!0;try{const a=await $.get(l);a.data.success?(_.value=a.data.products,b.value=a.data.pagination):v("error",a.data.message||"產品載入失敗")}catch(a){console.error("載入產品失敗",a),v("error","產品載入失敗")}finally{m.value=!1}},x=(t,l)=>{s.value=t,i.value=t?{}:{...l},y.value.showModal()},M=async t=>{i.value=t;let l="https://vue3-course-api.hexschool.io/v2/api/xenosword-api/admin/product",a="post";s.value||(l=`https://vue3-course-api.hexschool.io/v2/api/xenosword-api/admin/product/${t.id}`,a="put");try{const o=await $[a](l,{data:i.value});y.value.hideModal(),o.data.success?(v("success",s.value?"新增產品成功":"更新產品成功"),await g(b.value?.current_page||1)):v("error",o.data.message||"產品儲存失敗")}catch(o){console.error("儲存產品失敗",o),v("error","產品儲存失敗，請確認欄位")}},U=t=>{i.value={...t},h.value.showModal()},n=async()=>{const t=`https://vue3-course-api.hexschool.io/v2/api/xenosword-api/admin/product/${i.value.id}`;try{await $.delete(t),h.value.hideModal(),v("success","產品已刪除"),await g(b.value?.current_page||1)}catch(l){console.error("刪除產品失敗",l),v("error","產品刪除失敗")}};return B(g),(t,l)=>{const a=I("Loading");return c(),u(P,null,[w(a,{active:m.value},null,8,["active"]),e("div",ge,[l[2]||(l[2]=e("h2",{class:"h4 fw-bold"},"產品管理",-1)),e("button",{class:"btn btn-primary d-flex align-items-center gap-2",onClick:l[0]||(l[0]=o=>x(!0))},[...l[1]||(l[1]=[e("i",{class:"bi bi-plus-circle"},null,-1),e("span",null,"新增產品",-1)])])]),e("div",fe,[e("table",ye,[l[5]||(l[5]=e("thead",{class:"table-light"},[e("tr",null,[e("th",{width:"120"},"分類"),e("th",null,"產品名稱"),e("th",{width:"120",class:"text-start"},"原價"),e("th",{width:"120",class:"text-start"},"售價"),e("th",{width:"100",class:"text-center"},"狀態"),e("th",{width:"200",class:"text-center"},"操作")])],-1)),e("tbody",null,[(c(!0),u(P,null,N(_.value,o=>(c(),u("tr",{key:o.id},[e("td",null,f(o.category),1),e("td",null,f(o.title),1),e("td",he,f(t.$filters.currency(o.origin_price)),1),e("td",_e,f(t.$filters.currency(o.price)),1),e("td",xe,[e("span",{class:E(["badge",o.is_enabled?"bg-success":"bg-secondary"])},f(o.is_enabled?"啟用中":"未啟用"),3)]),e("td",Ue,[e("div",we,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:D=>x(!1,o)},[...l[3]||(l[3]=[e("i",{class:"bi bi-pencil-square"},null,-1),V(" 編輯 ",-1)])],8,$e),e("button",{class:"btn btn-outline-danger btn-sm",onClick:D=>U(o)},[...l[4]||(l[4]=[e("i",{class:"bi bi-trash"},null,-1),V(" 刪除 ",-1)])],8,ke)])])]))),128))])])]),w(T,{pages:b.value,onEmitPages:g},null,8,["pages"]),w(be,{ref_key:"productModal",ref:y,product:i.value,isNew:s.value,onUpdateProduct:M},null,8,["product","isNew"]),w(z,{ref_key:"delModal",ref:h,item:i.value,onDelItem:n},null,8,["item"])],64)}}};export{Ve as default};
